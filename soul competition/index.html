<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå…±åˆ›è®°å¿†ä¼™ä¼´ - èŠå¤©çºªå¿µå¡</title>
    <style>
        /* æ–°å¢æµªæ¼«æ¸©é¦¨é…è‰²æ–¹æ¡ˆ */
        :root {
            --primary-color: #ff6b81; /* æŸ”å’Œçš„ç«ç‘°ç²‰ */
            --secondary-color: #a29bfe; /* è–°è¡£è‰ç´« */
            --bg-color: #fcefee; /* æµ…ç±³ç™½/æ·¡ç²‰èƒŒæ™¯ */
            --card-bg-start: #ffffff;
            --card-bg-end: #ffebee; /* å¡ç‰‡æŸ”å’Œæ¸å˜ */
            --text-dark: #4a4a68; /* æ·±ç°ç´«æ–‡æœ¬ */
            --text-light: #7f8fa6;
            --tag-color: #ffaa9b; /* æŸ”å’Œçš„æ©™ç²‰æ ‡ç­¾ */
            --comment-border: #ffccbc; /* æš–æ©™è¾¹æ¡† */
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color); /* ä½¿ç”¨æµ…ç±³ç™½/æ·¡ç²‰èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-dark);
        }

        .container {
            background: #fff;
            padding: 50px; /* å¢åŠ å†…è¾¹è· */
            border-radius: 25px; /* æ›´åœ†æ¶¦ */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08); /* æ›´æŸ”å’Œçš„é˜´å½± */
            max-width: 800px;
            width: 90%;
            transition: all 0.5s ease;
        }

        h1 {
            color: var(--primary-color); /* ç«ç‘°ç²‰æ ‡é¢˜ */
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            letter-spacing: 2px; /* å¢åŠ å­—æ¯é—´è· */
            text-shadow: 1px 1px 3px rgba(255, 107, 129, 0.3); /* æŸ”å’Œçš„æ–‡å­—é˜´å½± */
        }

        .input-section {
            margin-bottom: 30px;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid var(--comment-border); /* æŸ”å’Œçš„è¾¹æ¡† */
            border-radius: 15px; /* æ›´åœ†æ¶¦ */
            resize: vertical;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color); /* ç«ç‘°ç²‰æŒ‰é’® */
            color: white;
            border: none;
            border-radius: 15px; /* æ›´åœ†æ¶¦ */
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s;
            font-weight: 500;
            letter-spacing: 1px;
        }

        button:hover {
            background-color: #e85a70;
        }

        button:active {
            transform: scale(0.98);
        }
        
        button:disabled {
            background-color: var(--tag-color);
            cursor: not-allowed;
        }

        /* è®°å¿†å¡ç‰‡æ ·å¼ - æ ¸å¿ƒç¾åŒ–åŒºåŸŸ */
        #memory-card-container {
            display: none;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px dashed var(--comment-border); /* æš–è‰²è™šçº¿ */
        }

        .memory-card {
            /* æµªæ¼«çš„æš–è‰²æ¸å˜èƒŒæ™¯ */
            background: linear-gradient(145deg, var(--card-bg-start) 0%, var(--card-bg-end) 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(255, 107, 129, 0.2); /* ç«ç‘°ç²‰è‰²é˜´å½± */
            animation: fadeIn 1.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            text-align: center;
            color: var(--secondary-color); /* è–°è¡£è‰ç´«æ—¥æœŸ */
            margin-bottom: 25px;
        }

        .card-header h2 {
            margin: 5px 0 0;
            font-size: 28px;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        .card-header p {
             font-weight: 500;
             font-size: 15px !important;
        }

        .card-content {
            display: flex;
            gap: 30px;
            border-bottom: 1px dashed var(--comment-border);
            padding-bottom: 20px;
        }
        
        .summary-block h3, .keywords-block h3 {
            color: var(--secondary-color);
            font-size: 18px;
            margin-top: 0;
            border-left: 4px solid var(--secondary-color);
            padding-left: 10px;
            font-weight: 600;
        }

        .summary-block {
            flex: 2;
        }

        .keywords-block {
            flex: 1;
        }

        .keywords-block p, .summary-block p {
            margin-top: 10px;
            font-size: 15px;
            color: var(--text-dark); /* æ·±è‰²æ–‡æœ¬ï¼Œä¿è¯å¯è¯»æ€§ */
            line-height: 1.7;
        }

        .keywords-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 40px;
        }

        .keyword-tag {
            background-color: var(--tag-color); /* æŸ”å’Œçš„æ©™ç²‰æ ‡ç­¾ */
            color: white;
            padding: 8px 15px;
            border-radius: 25px; /* æ›´åœ†æ¶¦ */
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(255, 170, 155, 0.4);
        }

        .ai-comment {
            margin-top: 25px;
            padding: 20px;
            background-color: var(--card-bg-end); /* ä½¿ç”¨å¡ç‰‡æ¸å˜è‰²çš„å°¾è‰² */
            border-left: 5px solid var(--primary-color); /* ç«ç‘°ç²‰å¼ºè°ƒè¾¹ */
            border-radius: 10px;
            font-style: italic;
            color: var(--text-dark);
        }

        .ai-comment p {
            margin: 0;
            line-height: 1.8;
            font-size: 16px;
        }
        
        /* åº•éƒ¨æ“ä½œæŒ‰é’®ä¼˜åŒ– */
        .action-buttons button {
            width: 49%; /* è°ƒæ•´å®½åº¦ä»¥é€‚é…æ–°çš„é—´è· */
            display: inline-block;
            margin-top: 0;
            padding: 12px 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 400;
        }
        
        .action-buttons .share-btn {
            background-color: #4CAF50; /* ç»¿è‰²ç³»ä¿æŒæ´»åŠ› */
        }
        .action-buttons .share-btn:hover {
            background-color: #388E3C;
        }

        .action-buttons .timeline-btn {
            background-color: var(--secondary-color); /* è–°è¡£è‰ç´« */
        }
        .action-buttons .timeline-btn:hover {
            background-color: #8c83e1;
        }


        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            .card-content {
                flex-direction: column;
            }
            .action-buttons button {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’– AI å…±åˆ›è®°å¿†ä¼™ä¼´</h1>
    <p style="text-align: center; color: var(--text-light); margin-bottom: 25px;">ç²˜è´´ä½ å’Œæœ‹å‹çš„èŠå¤©è®°å½•ï¼Œè®©AIä¸ºä½ ç”Ÿæˆä¸€ä»½**æ¸©é¦¨æµªæ¼«**çš„æ•°å­—çºªå¿µå“ï¼</p>

    <div class="input-section">
        <textarea id="chat-input" placeholder="è¯·ç²˜è´´èŠå¤©è®°å½•... (ä¾‹å¦‚ï¼šA: ä»Šå¤©å¤©æ°”çœŸå¥½ï¼ B: å¯¹å•Šï¼Œæˆ‘ä»¬ä¸Šæ¬¡èŠçš„é‚£ä¸ªé¡¹ç›®æ€ä¹ˆæ ·äº†ï¼Ÿ A: è¿›å±•å¾ˆé¡ºåˆ©... )"></textarea>
        <button id="generate-btn">ç”Ÿæˆä¸“å±è®°å¿†å¡ç‰‡</button>
    </div>

    <div id="memory-card-container">
        <div class="memory-card">
            <div class="card-header">
                <p style="font-size: 14px; color: var(--secondary-color);">â€”â€” ğŸ’Œ <span id="card-date"></span> ä¸“å±çºªå¿µ â€”â€”</p>
                <h2>**è¿™æ¬¡è¿æ¥çš„ç²¾å**</h2>
            </div>
            
            <div class="card-content">
                <div class="summary-block">
                    <h3>ğŸ“š å¯¹è¯æ‘˜è¦</h3>
                    <p id="summary-output">AIæ­£åœ¨åˆ†æä¸­...</p>
                </div>
                
                <div class="keywords-block">
                    <h3>ğŸ’¡ å…±åŒé«˜é¢‘è¯</h3>
                    <div class="keywords-list" id="keywords-output">
                        </div>
                </div>
            </div>

            <div class="ai-comment">
                <p id="comment-output">AIæ­£åœ¨ç”Ÿæˆæš–å¿ƒç‚¹è¯„...</p>
            </div>
        </div>
        
        <div class="action-buttons" style="text-align: center; margin-top: 25px; display: flex; justify-content: space-between;">
            <button onclick="alert('åˆ†äº«åŠŸèƒ½å¾…å®ç°ï¼')" class="share-btn">åˆ†äº«è¿™ä»½è®°å¿†</button>
            <button onclick="alert('å…³ç³»æˆé•¿æ—¶é—´è½´åŠŸèƒ½å¾…å®ç°ï¼')" class="timeline-btn">æŸ¥çœ‹å…³ç³»æ—¶é—´è½´</button>
        </div>
    </div>
</div>

<script>
    // ** ğŸ“¢ æ ¸å¿ƒæ›¿æ¢åŒºåŸŸ 1: å¡«å…¥ä½ çš„ API Key å’Œ é…ç½® **
    // ------------------------------------------------------------------
    // æ³¨æ„ï¼šæ™ºè°± AI çš„ Key é€šå¸¸ä»¥ 'sk-' å¼€å¤´
    const ZHIPU_API_KEY = '20881ad774ab4b1c80a856aae9a2650f.aYzweYGUQR2RhltJ'; // <-- æ›¿æ¢æˆä½ çš„çœŸå® Key
    
    // æ™ºè°± AI çš„ API ç»ˆç«¯ç‚¹
    const API_ENDPOINT = 'https://open.bigmodel.cn/api/paas/v4/chat/completions';
    
    // æ¨èä½¿ç”¨çš„æ¨¡å‹ (ä½ å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹© glm-4 æˆ–å…¶ä»–æ”¯æŒ JSON è¾“å‡ºçš„æ¨¡å‹)
    const MODEL_NAME = 'glm-4-flash'; 
    // ------------------------------------------------------------------


    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('card-date').textContent = new Date().toLocaleDateString('zh-CN');
    });

    document.getElementById('generate-btn').addEventListener('click', async () => {
        const chatInput = document.getElementById('chat-input').value.trim();
        const generateBtn = document.getElementById('generate-btn');
        const cardContainer = document.getElementById('memory-card-container');
        const summaryOutput = document.getElementById('summary-output');
        const keywordsOutput = document.getElementById('keywords-output');
        const commentOutput = document.getElementById('comment-output');

        if (!ZHIPU_API_KEY || ZHIPU_API_KEY === 'YOUR_ZHIPU_AI_API_KEY_HERE') {
             alert('é”™è¯¯ï¼šè¯·å…ˆåœ¨ä»£ç ä¸­æ›¿æ¢ YOUR_ZHIPU_AI_API_KEY_HERE ä¸ºä½ çš„çœŸå® Keyï¼');
             return;
        }

        if (chatInput.length < 50) {
            alert('èŠå¤©è®°å½•å¤ªçŸ­äº†ï¼Œè¯·ç²˜è´´ä¸€æ®µæ›´å®Œæ•´çš„å¯¹è¯ï¼');
            return;
        }

        // 1. ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        generateBtn.textContent = 'ğŸ§  AI Agent æ­£åœ¨æ¢³ç†è®°å¿†...';
        generateBtn.disabled = true;
        cardContainer.style.display = 'block';

        // æ¸…ç©º/é‡ç½®æ•°æ®
        summaryOutput.textContent = 'æ­£åœ¨æ·±å…¥åˆ†æå¯¹è¯å†…å®¹...';
        keywordsOutput.innerHTML = '';
        commentOutput.textContent = 'æ­£åœ¨æç‚¼æƒ…æ„Ÿå’Œç”Ÿæˆæš–å¿ƒç‚¹è¯„...';

        // 2. æ„é€  Prompt (æŒ‡ä»¤)
        const prompt = `ä½ æ˜¯ä¸€ä¸ªæƒ…æ„Ÿè®°å¿†AI Agentï¼Œè¯·æ ¹æ®ä»¥ä¸‹èŠå¤©è®°å½•ï¼Œå®Œæˆä»¥ä¸‹ä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸¥æ ¼ä»¥ JSON æ ¼å¼è¿”å›ç»“æœï¼š
èŠå¤©è®°å½•ï¼š"""${chatInput}"""

ä»»åŠ¡1: æå–æœ¬æ¬¡èŠå¤©çš„æ ¸å¿ƒæ‘˜è¦ï¼ˆä¸è¶…è¿‡100å­—ï¼‰ã€‚
ä»»åŠ¡2: æå–5ä¸ªæœ€é‡è¦æˆ–æœ€é«˜é¢‘çš„å…³é”®è¯ã€‚
ä»»åŠ¡3: æ ¹æ®å¯¹è¯å†…å®¹ç”Ÿæˆä¸€å¥æš–å¿ƒçš„æ€»ç»“æ€§ç‚¹è¯„ï¼ˆä¸è¶…è¿‡50å­—ï¼‰ã€‚

è¿”å›çš„JSONæ ¼å¼å¿…é¡»ä¸¥æ ¼å¦‚ä¸‹ï¼Œä¸”åªåŒ…å« JSON å¯¹è±¡ï¼Œä¸åŒ…å«ä»»ä½•é¢å¤–è¯´æ˜ï¼š
{
  "summary": "...",
  "keywords": ["è¯1", "è¯2", "è¯3", "è¯4", "è¯5"],
  "comment": "..."
}`;

        let requestBody;
        let requestHeaders = {
            'Content-Type': 'application/json',
            // ** æ ¸å¿ƒæ›¿æ¢åŒºåŸŸ 2: å¡«å…¥æˆæƒ Header **
            'Authorization': `Bearer ${ZHIPU_API_KEY}` // æ™ºè°± AI é‡‡ç”¨ Bearer Token è®¤è¯
        };

        // æ„é€ è¯·æ±‚ä½“ï¼šæ™ºè°± AI çš„ Chat Completions æ¥å£
        requestBody = JSON.stringify({
            model: MODEL_NAME, 
            messages: [
                {
                    role: "system",
                    // å¼ºåˆ¶æ¨¡å‹è¿”å› JSON æ ¼å¼
                    content: "ä½ æ˜¯ä¸€ä¸ªæƒ…æ„Ÿè®°å¿†AI Agentã€‚è¯·ä¸¥æ ¼æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„JSONæ ¼å¼è¿”å›åˆ†æç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„æ–‡å­—æˆ–markdownç¬¦å·ã€‚"
                },
                {
                    role: "user",
                    content: prompt // æˆ‘ä»¬çš„è¯¦ç»†æŒ‡ä»¤å’ŒèŠå¤©è®°å½•
                }
            ],
            // ä½¿ç”¨ response_format å‚æ•°æ¥è¯·æ±‚ JSON æ ¼å¼è¾“å‡º
            response_format: { type: "json_object" }
        });


        try {
            // 3. å‘é€ API è¯·æ±‚
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: requestHeaders,
                body: requestBody
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                console.error("API Error Response:", errorData);
                throw new Error(`API Request failed with status: ${response.status}. è¯·æ£€æŸ¥ Key æˆ– CORS è®¾ç½®ã€‚`);
            }

            const result = await response.json();
            let aiData;
            
            // ** æ ¸å¿ƒæ›¿æ¢åŒºåŸŸ 3: è§£æ API å“åº” **
            // ------------------------------------------------------------------
            if (result.choices && result.choices.length > 0 && result.choices[0].message) {
                // æå–æ¨¡å‹è¿”å›çš„ JSON å­—ç¬¦ä¸²
                const jsonText = result.choices[0].message.content.trim();
                
                // å°è¯•è§£æ JSON å­—ç¬¦ä¸²
                try {
                    aiData = JSON.parse(jsonText);
                } catch (e) {
                    console.error("JSON è§£æå¤±è´¥:", jsonText, e);
                    throw new Error("æ¨¡å‹è¿”å›çš„æ–‡æœ¬ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ã€‚");
                }
            } else {
                console.error("Unexpected API result structure:", result);
                throw new Error("AI Agent è¿”å›çš„æ•°æ®ç»“æ„ä¸æ­£ç¡®ã€‚");
            }
            // ------------------------------------------------------------------


            // 4. æ›´æ–°ç•Œé¢
            if (aiData.summary && aiData.keywords && aiData.comment) {
                summaryOutput.textContent = aiData.summary;
                commentOutput.textContent = aiData.comment;
                
                keywordsOutput.innerHTML = '';
                aiData.keywords.forEach(keyword => {
                    const tag = document.createElement('span');
                    tag.className = 'keyword-tag';
                    tag.textContent = keyword;
                    keywordsOutput.appendChild(tag);
                });
            } else {
                throw new Error("AI Agent è¿”å›çš„ JSON ç¼ºå°‘å¿…è¦çš„å­—æ®µ (summary, keywords, æˆ– comment)ã€‚");
            }

        } catch (error) {
            console.error('AI Agentå¤„ç†å¤±è´¥:', error);
            summaryOutput.textContent = 'âŒ AI Agentå¤„ç†å¤±è´¥ã€‚è¯·æ£€æŸ¥ï¼šKeyæ˜¯å¦æ­£ç¡®ã€CORSè·¨åŸŸé—®é¢˜ã€æˆ–æ¨¡å‹æ˜¯å¦è¿”å›äº†æ­£ç¡®çš„JSONæ ¼å¼ã€‚';
            keywordsOutput.innerHTML = '<span class="keyword-tag" style="background-color: #dc3545;">é”™è¯¯</span>';
            commentOutput.textContent = `å¾ˆæŠ±æ­‰ï¼Œç”Ÿæˆç‚¹è¯„æ—¶å‡ºç°é”™è¯¯ã€‚è¯¦ç»†ä¿¡æ¯ï¼š${error.message.substring(0, 100)}...`;
        } finally {
            // 5. æ¢å¤æŒ‰é’®çŠ¶æ€
            generateBtn.textContent = 'ç”Ÿæˆä¸“å±è®°å¿†å¡ç‰‡';
            generateBtn.disabled = false;
        }
    });
</script>

</body>
</html>